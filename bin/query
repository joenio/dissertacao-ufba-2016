#!/usr/bin/perl
use utf8;
use open ':locale';
use Modern::Perl '2014';
use lib 'lib';
use Dissertacao qw( query unique bibtex_load );

=head1 NAME

query - print unique references satisfying some constraint

=head1 SYNOPSIS

  ./bin/query <input-file> [<input-file> [<input-file>]] [really_refers_to_software=yes]

=cut

my %results = ();
if ($ARGV[-1] =~ m/^.+=.+$/) {
  my %constraints = split(/=/, pop @ARGV);
  %results = unique query(%constraints, bibtex_load @ARGV);
}
else {
  %results = unique bibtex_load @ARGV;
}
foreach (sort keys %results) {
  print $results{$_}->print_s;
}
