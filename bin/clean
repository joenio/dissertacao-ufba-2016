#!/usr/bin/perl
use Modern::Perl '2014';
use utf8;
use open ':locale';
use lib 'lib';
use Dissertacao qw( foreach_bibtex_entry );

=head1 NAME

clean - remove some custom fields from the bibtex files

=head1 SYNOPSIS

  ./bin/clean <input-file> [<input-file> [<input-file>]]

=head1 DESCRIPTION

Remove fields (really_refers_to_software, contribution_weight,
weightless_contributions, conference, step) from each entry and prints results
to the standard output.

Also remove all entries with has no title.
    
=cut

if (@ARGV < 1) {
  warn "E: missing options!";
  say "Usage: $0 <input-file> [<input-file> [<input-file>]]";
  exit 1;
}

foreach_bibtex_entry(@ARGV, sub {
  my $entry = shift;
  $entry->delete(
    'review',
    'really_refers_to_software',
    'contribution_weight',
    'weightless_contributions',
    'conference',
    'step',
  );
  print $entry->print_s if $entry->get('title');
});
