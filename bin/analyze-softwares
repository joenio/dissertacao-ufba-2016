#!/usr/bin/perl
use Modern::Perl '2014';
use Devel::CheckBin;

sub run_source_code_metrics_tools {
  my $dir = shift;
  foreach my $s (grep { -d $_ } glob("$dir/*")) {
    foreach my $release (grep { -d $_ } glob("$s/source-code/*")) {
      unless (-e "$release.analizo.metrics") {
        say "analizo metrics $release > $release.analizo.metrics";
        `analizo metrics $release > $release.analizo.metrics`;
      }
      unless (-e "$release.sloccount") {
        say "sloccount $release > $release.sloccount";
        `sloccount $release > $release.sloccount`;
      }
    }
  }
}

if (can_run('analizo') && can_run('sloccount')) {
  run_source_code_metrics_tools("$ENV{PWD}/dataset/software");
}
else {
  die "E: analizo or sloccound not found, please install them!";
}
